L.Icon.Default.imagePath="/build/images";var mymap=L.map("map_display").setView([53.907574,27.563224],15);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw",{maxZoom:18,id:"mapbox.streets"}).addTo(mymap);var markers=new L.MarkerClusterGroup;mymap.addLayer(markers);var app=angular.module("myApp",[]);app.controller("formCtrl",["$scope","$http",function(a,b){function c(c){b({method:"GET",dataType:"jsonp",url:"https://api.hh.ru/dictionaries"}).then(function(b){a.text_label="Text",a.experience_label=b.data.vacancy_cluster[5].name,a.employment_label=b.data.vacancy_cluster[9].name,a.schedule_label=b.data.vacancy_cluster[2].name,a.currency_label="Currency",a.salary_label=b.data.vacancy_cluster[7].name,a.currencies=b.data.currency,a.experiencies=b.data.experience,a.employments=b.data.employment,a.schedules=b.data.schedule,c()},function(b){a.error=b.statusText})}function d(){var c=mymap.getBounds();mymap.getZoom();b({method:"GET",dataType:"jsonp",url:"https://api.hh.ru/vacancies?per_page=500&enable_snippets=true&label=with_address&isMap=true&bottom_lat="+c.getSouth()+"&left_lng="+c.getWest()+"&top_lat="+c.getNorth()+"&right_lng="+c.getEast()+(a.text.length>0?"&text="+a.text:"")+(a.salary.length>0?"&salary="+a.salary+"&only_with_salary=true":"")+(a.currency.length>0?"&currency="+a.currency:"")+(a.experience.length>0?"&experience="+a.experience:"")+(a.employment.length>0?"&employment="+a.employment:"")+(a.schedule.length>0?"&schedule="+a.schedule:"")}).then(function(b){a.error="";var c=b.data.items;markers.clearLayers();for(var d=0;d<c.length;d++){var e=c[d].address.lat,f=c[d].address.lng,g="<b>"+c[d].employer.name+"</b><br />"+c[d].name;if(null!=e&&null!=f){var h=L.marker(new L.LatLng(e,f),{title:g});h.bindPopup(g),markers.addLayer(h)}}},function(b){a.error=b.statusText})}a.text="",a.experience="",a.employment="",a.schedule="",a.currency="",a.salary="",a.text_label="Ключевые слова",a.experience_label="",a.employment_label="",a.schedule_label="",a.currency_label="Валюта",a.salary_label="",a.error="",a.update=function(){d()};mymap.getBounds();mymap.on("moveend",d),c(d)}]);